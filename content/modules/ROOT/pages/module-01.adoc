= Prerequisites

In order to start the whole exercise from the `{ocpai}` perspective, we will need to deploy and configure some applications and resources which will be used later on:

== MinIO

The model we want to train and use later on needs to reside somewhere. `{ocpai}` has a featue which is called `Data Connection` where we can reference storage used for serving our model later on. This storage needs to be an S3 bucket, therefore we will make use of `MinIO` which enables us to create such buckets in our cluster.

=== Install MinIO:

. Create a `namespace` named `minio-{user}`. To do so, simply create a `project` (which will also create the `namespace`):
+
image::project-admin.png[Create a new project in OpenShift]
+
Only the name is required and relevant here, make sure to put in `minio-{user}`
+
image::project-modal.png[Create a new project in OpenShift]

. Now we need to import the relevant YAML resources. Head to the Import YAML view (reminder: plus icon at the upper right hand corner). After creating the `project` it should automatically be the selected `project`, double check this in the Import YAML view:
+
image::minio-import-yaml.png[Create a new project in OpenShift]
+
*Instead of `minio-userx` it should be `minio-{user}`

. In the Import YAML view, paste the following resources and click on `create`:
+
[source,yaml,role=execute]
----
apiVersion: v1
kind: Service
metadata:
  labels:
    app: minio
    app.kubernetes.io/component: minio
    app.kubernetes.io/instance: minio
    app.kubernetes.io/name: minio
    app.kubernetes.io/part-of: minio
    component: minio
  name: minio
spec:
  ports:
    - name: api
      port: 9000
      targetPort: api
    - name: console
      port: 9090
      targetPort: 9090
  selector:
    app: minio
    app.kubernetes.io/component: minio
    app.kubernetes.io/instance: minio
    app.kubernetes.io/name: minio
    app.kubernetes.io/part-of: minio
    component: minio
  sessionAffinity: None
  type: ClusterIP
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  labels:
    app: minio
    app.kubernetes.io/component: minio
    app.kubernetes.io/instance: minio
    app.kubernetes.io/name: minio
    app.kubernetes.io/part-of: minio
    component: minio
  name: minio
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    app: minio
    app.kubernetes.io/component: minio
    app.kubernetes.io/instance: minio
    app.kubernetes.io/name: minio
    app.kubernetes.io/part-of: minio
    component: minio
  name: minio-root-user
type: Opaque
stringData:
    MINIO_ROOT_USER: minio
    MINIO_ROOT_PASSWORD: minio123
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: minio
    app.kubernetes.io/component: minio
    app.kubernetes.io/instance: minio
    app.kubernetes.io/name: minio
    app.kubernetes.io/part-of: minio
    component: minio
  name: minio
spec:
  replicas: 1
  selector:
    matchLabels:
      app: minio
      app.kubernetes.io/component: minio
      app.kubernetes.io/instance: minio
      app.kubernetes.io/name: minio
      app.kubernetes.io/part-of: minio
      component: minio
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: minio
        app.kubernetes.io/component: minio
        app.kubernetes.io/instance: minio
        app.kubernetes.io/name: minio
        app.kubernetes.io/part-of: minio
        component: minio
    spec:
      containers:
        - args:
            - minio server /data --console-address :9090
          command:
            - /bin/bash
            - -c
          envFrom:
            - secretRef:
                name: minio-root-user
          image: quay.io/minio/minio:latest
          name: minio
          ports:
            - containerPort: 9000
              name: api
              protocol: TCP
            - containerPort: 9090
              name: console
              protocol: TCP
          resources:
            limits:
              cpu: "1"
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 512Mi
          volumeMounts:
            - mountPath: /data
              name: minio
      volumes:
        - name: minio
          persistentVolumeClaim:
            claimName: minio
        - emptyDir: {}
          name: empty
---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  labels:
    app: minio
    app.kubernetes.io/component: minio
    app.kubernetes.io/instance: minio
    app.kubernetes.io/name: minio
    app.kubernetes.io/part-of: minio
    component: minio
  name: minio-console
spec:
  port:
    targetPort: console
  tls:
    insecureEdgeTerminationPolicy: Redirect
    termination: edge
  to:
    kind: Service
    name: minio
    weight: 100
  wildcardPolicy: None
---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  labels:
    app: minio
    app.kubernetes.io/component: minio
    app.kubernetes.io/instance: minio
    app.kubernetes.io/name: minio
    app.kubernetes.io/part-of: minio
    component: minio
  name: minio-s3
spec:
  port:
    targetPort: api
  tls:
    insecureEdgeTerminationPolicy: Redirect
    termination: edge
  to:
    kind: Service
    name: minio
    weight: 100
  wildcardPolicy: None
----
.. Feel free to check the resources which are being generated. A small rundown on these:
+
... `Deployment`: the main resource which will reference the used MinIO image and deploy it
... `Service`: define how the deployment will be accessible from a network perspective - mainly port definitions
... `PersistentVolumeClaim`: MinIO will enable us to create and expose S3 buckets, therefore object storage - that needs storage to begin with and this resource will attach storage to MinIO which it can then use
... `Secret`: contains the credentials for the root user of your MinIO instance
... `Route`: two of them, references the used `Service` to expose it and make it available outside the your cluster - in this case for the API and the Console (UI) of MinIO

NOTE: You can see that none of the resources above mention a `namespace` attribute. This is because this makes it more flexible so that the used `namespace` will be derived from the currently selected one. That's why it's important to create one before and make sure it's selected.

NOTE: The login credentials for your MinIO instance can be seen in the `Secret`, it's `minio` with `minio123`.

=== Create a bucket